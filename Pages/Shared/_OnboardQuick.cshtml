@* Modal centrado para parametrizar rápidamente la empresa *@
<div id="onb-overlay" class="onb-overlay d-none">
  <div class="onb-modal card shadow">
    <div class="card-header d-flex justify-content-between align-items-center">
      <strong>Parametrizar <span id="onb-company">Empresa</span></strong>
      <button type="button" class="btn-close" aria-label="Close" id="onb-close"></button>
    </div>
    <div class="card-body">
      <p class="mb-3">Antes de empezar se debe configurar la empresa.</p>
      <form method="post" asp-page="/Onboarding/QuickPublish" id="onb-form">
        <input type="hidden" name="RealmId" id="onb-realm" />
        <div class="d-flex gap-2 justify-content-end">
          <a href="/Auth/Connect" class="btn btn-outline-secondary" id="onb-cancel">Cancelar</a>
          <button type="submit" class="btn btn-primary">Listo</button>
        </div>
      </form>
    </div>
  </div>
</div>

@section Scripts {
<script>
(function(){
  function getCookie(n){
    var m = document.cookie.match(new RegExp('(?:^|; )' + n.replace(/([.$?*|{}()\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + '=([^;]*)'));
    return m ? decodeURIComponent(m[1]) : null;
  }
  var c = getCookie('onb_company') || getCookie('onb_connect');
  if (c){
    var mp = {};
    c.split('|').forEach(function(p){ var i=p.indexOf('='); if(i>0){ mp[p.substring(0,i)] = p.substring(i+1); }});
    if (mp['company']) document.getElementById('onb-company').textContent = mp['company'];
    if (mp['realm'])   document.getElementById('onb-realm').value = mp['realm'];
    document.getElementById('onb-overlay').classList.remove('d-none');
    // limpiar para que no reabra
    document.cookie = 'onb_company=; Max-Age=0; path=/';
    document.cookie = 'onb_connect=; Max-Age=0; path=/';
  }
  var closeBtn = document.getElementById('onb-close');
  if (closeBtn) closeBtn.addEventListener('click', function(e){ e.preventDefault(); document.getElementById('onb-overlay').classList.add('d-none'); });
})();
</script>
}
