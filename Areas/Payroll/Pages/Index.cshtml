@page
@{
    ViewData["Title"] = "Principal";
    var today = DateTime.Today;
    var start = new DateTime(today.Year, today.Month, 1).ToString("yyyy-MM-dd");
    var end   = new DateTime(today.Year, today.Month, DateTime.DaysInMonth(today.Year, today.Month)).ToString("yyyy-MM-dd");
    var todayIso = today.ToString("yyyy-MM-dd");
}
<partial name="~/Areas/Payroll/Components/_Topbar.cshtml" />

<h1 class="mb-3">Principal</h1>

<div class="row g-3">
  <div class="col-12 col-lg-4">
    <div class="card h-100">
      <div class="card-header">Calendario</div>
      <div class="card-body">
        <div class="d-flex align-items-center gap-2 mb-2">
          <div class="flex-grow-1">
            <label class="form-label small mb-1">Desde</label>
            <input id="dtFrom" type="date" class="form-control form-control-sm" value="@start" />
          </div>
          <div class="flex-grow-1">
            <label class="form-label small mb-1">Hasta</label>
            <input id="dtTo" type="date" class="form-control form-control-sm" value="@end" />
          </div>
        </div>
        <small class="text-muted">Arrastra en el calendario (placeholder) o usa las fechas para filtrar.</small>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-8">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Eventos</span>
        <span id="evtDate" class="text-muted small">@todayIso</span>
      </div>
      <div class="card-body">
        <div id="evtPeriod" class="mb-3">
          <div class="text-muted small mb-2">Del período seleccionado</div>
          <ul id="listPeriod" class="list-unstyled mb-0"></ul>
        </div>
        <hr/>
        <div id="evtNext">
          <div class="text-muted small mb-2">Próximos</div>
          <ul id="listNext" class="list-unstyled mb-0"></ul>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="row g-3 mt-1">
      <div class="col-12 col-md-2"><div class="card"><div class="card-body"><div class="text-muted small">Bruto</div><div class="fs-5 fw-semibold">₡ 0.00</div></div></div></div>
      <div class="col-12 col-md-2"><div class="card"><div class="card-body"><div class="text-muted small">Deducciones</div><div class="fs-5 fw-semibold">₡ 0.00</div></div></div></div>
      <div class="col-12 col-md-2"><div class="card"><div class="card-body"><div class="text-muted small">Neto</div><div class="fs-5 fw-semibold">₡ 0.00</div></div></div></div>
      <div class="col-12 col-md-2"><div class="card"><div class="card-body"><div class="text-muted small">Patronales</div><div class="fs-5 fw-semibold">₡ 0.00</div></div></div></div>
      <div class="col-12 col-md-2"><div class="card"><div class="card-body"><div class="text-muted small"># Colab</div><div class="fs-5 fw-semibold">0</div></div></div></div>
      <div class="col-12 col-md-2"><div class="card"><div class="card-body"><div class="text-muted small">Horas Extra</div><div class="fs-5 fw-semibold">0.00</div></div></div></div>
    </div>
  </div>
</div>

@section Scripts {
<script>
(()=>{

  // dataset simple por empresa
  const data = {
    "Empresa A (demo)": {
      "2025-09": {
        period: [
          { date:"2025-09-03", title:"Verificar marcaciones", area:"RRHH" },
          { date:"2025-09-10", title:"Aprobar horas extra", area:"Jefaturas" },
          { date:"2025-09-18", title:"Cargar ausencias", area:"RRHH" }
        ],
        next: [
          { date:"2025-09-25", title:"Pago planilla", area:"Tesorería" },
          { date:"2025-09-27", title:"Reporte patronales", area:"Contabilidad" }
        ]
      }
    },
    "Empresa B (demo)": {
      "2025-09": {
        period: [
          { date:"2025-09-05", title:"Verificar marcaciones", area:"RRHH" },
          { date:"2025-09-12", title:"Aprobar horas extra", area:"Jefaturas" },
          { date:"2025-09-20", title:"Cargar ausencias", area:"RRHH" }
        ],
        next: [
          { date:"2025-09-26", title:"Pago planilla", area:"Tesorería" },
          { date:"2025-09-28", title:"Reporte patronales", area:"Contabilidad" }
        ]
      }
    }
  };

  const q = (s)=>document.querySelector(s);
  const listPeriod = q("#listPeriod");
  const listNext   = q("#listNext");
  const dtFrom     = q("#dtFrom");
  const dtTo       = q("#dtTo");
  const evtDate    = q("#evtDate");

  function getEmpresaActual(){
    const sel = document.querySelector('select.form-select');
    return sel?.value || "Empresa A (demo)";
  }

  function yyyymm(d){ return d.slice(0,7); }

  function render(){
    const emp = getEmpresaActual();
    const k   = yyyymm(dtFrom.value || "@start");
    const pack = (data[emp] && data[emp][k]) ? data[emp][k] : {period:[],next:[]};

    listPeriod.innerHTML = pack.period.map(e =>
      `<li class="mb-2"><span class="me-2">•</span><strong>${e.title}</strong><div class="text-muted small">${e.area}</div></li>`
    ).join("") || `<li class="text-muted">Sin eventos</li>`;

    listNext.innerHTML = pack.next.map(e =>
      `<li class="mb-2"><span class="me-2">•</span><strong>${e.title}</strong><div class="text-muted small">${e.area}</div></li>`
    ).join("") || `<li class="text-muted">Sin próximos</li>`;

    evtDate.textContent = (dtFrom.value || "@start");
  }

  // Hooks
  document.querySelectorAll('.form-select, #dtFrom, #dtTo').forEach(el=>{
    el.addEventListener('change', render);
  });

  render();
})();
</script>
}
