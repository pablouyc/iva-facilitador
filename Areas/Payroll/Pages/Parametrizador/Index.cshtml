@page "{id:int?}"
@model IvaFacilitador.Areas.Payroll.Pages.Parametrizador.IndexModel
@{
    ViewData["Title"] = "Parametrizador de nómina";
    ViewData["PayrollSection"] = "Empresas";
}
@await Html.PartialAsync("~/Areas/Payroll/Components/_Topbar.cshtml")

<div class="container mt-3">
    <h4 class="mb-3">Parametrizador de nómina</h4>

    <form method="post" asp-page-handler="Save">
        <input type="hidden" name="CompanyId" value="@Model.CompanyId" />

        <div class="mb-3">
            <label class="form-label">Empresa</label>
            <input class="form-control"
                   value="@(string.IsNullOrWhiteSpace(Model.CompanyName)
                             ? $"Empresa vinculada {Model.RealmId}"
                             : (Model.CompanyName + (string.IsNullOrWhiteSpace(Model.RealmId) ? "" : $" ({Model.RealmId})")))"
                   readonly />
        </div>

        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Cuenta de gasto predeterminada</label>
                <select asp-for="ExpenseAccountId" class="form-select">
                    <option value="">(sin seleccionar)</option>
                    @foreach (var a in Model.Accounts)
                    {
                        <option value="@a.Id" selected="@(Model.ExpenseAccountId == a.Id)">@a.Name</option>
                    }
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">Ítem de salario (Service)</label>
                <select asp-for="WageItemId" class="form-select">
                    <option value="">(sin seleccionar)</option>
                    @foreach (var i in Model.Items)
                    {
                        <option value="@i.Id" selected="@(Model.WageItemId == i.Id)">@i.Name</option>
                    }
                </select>
            </div>
        </div>

        <div class="mt-3 d-flex gap-2">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button class="btn btn-secondary" formmethod="post" formaction="?handler=Sync">Sincronizar desde QBO</button>
            <a href="/Payroll/Empresas" class="btn btn-outline-secondary">Volver</a>
        </div>
    </form>

    @if (!Model.HasTokens)
    {
        <div class="alert alert-warning mt-3">
            Esta empresa aún no está conectada a QBO Payroll.
            <form method="post" asp-page-handler="Connect" class="d-inline">
                <input type="hidden" name="CompanyId" value="@Model.CompanyId" />
                <button class="btn btn-sm btn-warning">Conectar con QBO</button>
            </form>
        </div>
    }
</div>
